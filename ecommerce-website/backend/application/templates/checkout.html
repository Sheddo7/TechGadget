{% extends "base.html" %}

{% block title %}Checkout - TechGadgets{% endblock %}

{% block content %}
<div class="checkout-page">
    <div class="container">
        <h1>üõí Checkout</h1>

        {% if not cart_items %}
        <div class="empty-cart-warning">
            <h2>Your cart is empty</h2>
            <p>Please add some items to your cart before checking out.</p>
            <a href="{{ url_for('products_page') }}" class="cta-button">Continue Shopping</a>
        </div>
        {% else %}
        <div class="checkout-container">
            <div class="checkout-form">
                <h2>Shipping & Payment</h2>

                <form method="POST" action="{{ url_for('checkout') }}">
                    <div class="form-section">
                        <h3>üì¶ Shipping Address</h3>
                        <div class="form-group">
                            <label for="shipping_address">Shipping Address *</label>
                            <textarea id="shipping_address" name="shipping_address" rows="3" required
                                      placeholder="Enter your complete shipping address">123 Main St, City, State 12345</textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üí∞ Billing Address</h3>
                        <div class="form-group">
                            <label for="billing_address">Billing Address *</label>
                            <textarea id="billing_address" name="billing_address" rows="3" required
                                      placeholder="Enter your complete billing address">123 Main St, City, State 12345</textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üí≥ Payment Method</h3>
                        <div class="form-group">
                            <label>Select Payment Method *</label>
                            <div class="payment-options">
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="credit_card" required checked>
                                    <span>üí≥ Credit Card</span>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="paypal">
                                    <span>üì± PayPal</span>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="bank_transfer">
                                    <span>üè¶ Bank Transfer</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="checkout-btn">
                        Place Order
                    </button>
                </form>
            </div>

            <div class="order-summary">
                <h3>Order Summary</h3>
                <div class="order-items">
                    {% for item in cart_items %}
                    <div class="order-item">
                        <img src="{{ item.image_url }}" alt="{{ item.name }}" onerror="this.src='https://via.placeholder.com/80x80?text=No+Image'">
                        <div class="item-details">
                            <h4>{{ item.name }}</h4>
                            <p>Qty: {{ item.quantity }}</p>
                            <p class="price">${{ "%.2f"|format(item.price) }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="summary-totals">
                    {% set subtotal = cart_items | sum(attribute='price') * cart_items | sum(attribute='quantity') %}
                    {% set shipping = 5.99 if subtotal < 50 else 0 %}
                    {% set total = subtotal + shipping %}

                    <div class="summary-line">
                        <span>Subtotal:</span>
                        <span>${{ "%.2f"|format(subtotal) }}</span>
                    </div>
                    <div class="summary-line">
                        <span>Shipping:</span>
                        <span>{% if shipping == 0 %}FREE{% else %}${{ "%.2f"|format(shipping) }}{% endif %}</span>
                    </div>
                    <div class="summary-line total">
                        <span>Total:</span>
                        <span>${{ "%.2f"|format(total) }}</span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}