{% extends "admin/base.html" %}

{% block title %}Sales Analytics - TechGadgets{% endblock %}
{% block page_title %}Sales Analytics{% endblock %}

{% block content %}
<div class="analytics">
    <!-- Overview Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">${{ "%.2f"|format(total_sales) }}</div>
            <div class="stat-label">Total Sales</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_orders }}</div>
            <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">${{ "%.2f"|format(avg_order_value) }}</div>
            <div class="stat-label">Average Order Value</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (total_orders / total_users * 100)|round(1) if total_users > 0 else 0 }}%</div>
            <div class="stat-label">Conversion Rate</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
        <!-- Monthly Sales -->
        <div class="data-table">
            <div style="padding: 1rem; border-bottom: 1px solid #ecf0f1; background: #34495e; color: white;">
                <h3 style="margin: 0;">Monthly Sales</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Orders</th>
                        <th>Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    {% for month in monthly_sales %}
                    <tr>
                        <td>{{ month.month }}</td>
                        <td>{{ month.order_count }}</td>
                        <td>${{ "%.2f"|format(month.revenue) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Order Status Distribution -->
        <div class="data-table">
            <div style="padding: 1rem; border-bottom: 1px solid #ecf0f1; background: #34495e; color: white;">
                <h3 style="margin: 0;">Order Status</h3>
            </div>
            <div style="padding: 2rem;">
                {% for status in status_distribution %}
                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #ecf0f1;">
                    <span style="text-transform: capitalize;">{{ status.status }}</span>
                    <span style="font-weight: bold;">{{ status.count }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Top Products -->
    <div class="data-table" style="margin-top: 2rem;">
        <div style="padding: 1rem; border-bottom: 1px solid #ecf0f1; background: #34495e; color: white;">
            <h3 style="margin: 0;">Top Selling Products</h3>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Units Sold</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
                {% for product in top_products %}
                <tr>
                    <td>
                        <a href="{{ url_for('product_detail', product_id=product.id) }}" target="_blank">
                            {{ product.name }}
                        </a>
                    </td>
                    <td>{{ product.total_sold }}</td>
                    <td>${{ "%.2f"|format(product.revenue) }}</td>
                </tr>
                {% endfor %}
                {% if not top_products %}
                <tr>
                    <td colspan="3" style="text-align: center; color: #7f8c8d; padding: 3rem;">
                        No sales data available
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}